<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"> -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css">
    <title>EleXcel</title>
</head>
<body>
    <h1>Hello world</h1>
    <form action="" method="post" enctype="multipart/form-data" id="myform">
        <!-- <input type="text" name="address_pt" id="" required>
        <input type="date" name="exp_date" required>
        <input type="date" name="created_at" id="" required> -->
        <input type="file" name="file_skrd" id="file_skrd" required>
        <input type="submit" value="Proses">
    </form>
    <script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>

    <!-- <a href="http://localhost:3000/oho">klik</a> -->
    <!-- <p>
        We are using Node.js <span id="node-version"></span>,
        Chromium <span id="chrome-version"></span>,
        and Electron <span id="electron-version"></span>.
    </p> -->
    <!-- <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <script>
        const { app, BrowserWindow } = require('@electron/remote');
        const path = require('path');
        const fs = require('fs');

        function mywind(examp){
            const win = new BrowserWindow({
                show: false,
                webPreferences: {
                    nodeIntegration:true,
                    contextIsolation: false,
                }
            })

            win.webContents.openDevTools();
        
            win.loadFile(path.join(__dirname, 'skrd.html'));

            win.webContents.send('data', examp);

            win.webContents.on('did-finish-load', () => {
                win.webContents.printToPDF({
                    // marginsType: 1,
                    //paper F4
                    pageSize: {
                        height: 13,//inch
                        width: 8.5,//inch
                    },
                    printBackground: true,
                    printSelectionOnly: false,
                    landscape: false
                }).then(data => {
                    fs.writeFile(app.getPath('downloads')+"/"+examp.namefile+".pdf", data, function (err) {
                        if (err) {
                            console.log(err);
                        } else {
                            console.log('PDF Generated Successfully');
                        }
                    });
                }).catch(error => {
                    console.log(error)
                });
            });
        }

        let input = document.getElementById('file_skrd')
        let myform = document.getElementById('myform')
        myform.addEventListener('submit', function(e) {
            e.preventDefault();
            try {
                for (let i = 1; i < 9; i++) {
                    readXlsxFile(input.files[0], { sheet:i }).then((rows) => {
                        let obj = new Object();

                        obj.tahun = 2023;
                        obj.data = rows;

                        rows.forEach((e, i) => {
                            if (e[0] && !Number.isInteger(e[0])) {
                                if (e[0].substr(0, 4) == 'PT. ') {
                                    obj.namefile=e[0];
                                    // return false;
                                }
                            }    
                            // if (Number.isInteger(e[0])) {
                            //     // console.log(e[7].split(""));
                            //     // return false;
                            // }       
                        });
                        mywind(obj);
                    });
                }
            } catch (error) {
                console.log(error);
            }           
        })
    </script>
    <!-- <script>if (window.module) module = window.module;</script> -->
</body>
</html>